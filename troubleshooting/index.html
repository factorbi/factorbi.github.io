<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-83822501-2"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-83822501-2');
  </script>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <meta name="author" content="Factor BI">
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Troubleshooting - Bipost Sync</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">

  <script>
    // Current page data
    var mkdocs_page_name = "Troubleshooting";
    var mkdocs_page_input_path = "troubleshooting.md";
    var mkdocs_page_url = "/troubleshooting/";
  </script>

  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">


    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> Bipost Sync</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">


            <li class="toctree-l1">

    <a class="" href="..">Home</a>
	    </li>

            <li class="toctree-l1">

    <a class="" href="../easyawssetup/">Link your AWS Account</a>
	    </li>

            <li class="toctree-l1">

    <a class="" href="../registration/">Factor BI Console</a>
	    </li>

            <li class="toctree-l1">

    <a class="" href="../installation/">Download Program</a>
	    </li>

            <li class="toctree-l1">

    <a class="" href="../sqlserver/">SQL Server to MySQL Aurora</a>
	    </li>

            <li class="toctree-l1">

    <a class="" href="../firebird/">Firebird to MySQL Aurora</a>
	    </li>

            <li class="toctree-l1">

    <a class="" href="../dbase/">dBase III to MySQL Aurora</a>
	    </li>

            <li class="toctree-l1">

    <a class="" href="../customdatajson/">Pick Tables & Data to Sync</a>
	    </li>

            <li class="toctree-l1">

    <a class="" href="../bipostapi/">Loading and Transformation</a>
	    </li>

            <li class="toctree-l1">

    <a class="" href="../synctowindows/">Two-way Synchronization</a>
	    </li>

            <li class="toctree-l1">

    <a class="" href="../aspel/">Aspel</a>
	    </li>

            <li class="toctree-l1">

    <a class="" href="../microsip/">Microsip</a>
	    </li>

            <li class="toctree-l1">

    <a class="" href="../intelisis/">Intelisis</a>
	    </li>

            <li class="toctree-l1">

    <a class="" href="../businessintelligence/">Business Intelligence</a>
	    </li>

            <li class="toctree-l1">

    <a class="" href="../csvtomysql/">CSV to MySQL Aurora</a>
	    </li>

            <li class="toctree-l1">

    <a class="" href="../setupaws/">Advanced AWS Setup</a>
	    </li>

            <li class="toctree-l1 current">

    <a class="current" href="./">Troubleshooting</a>
    <ul class="subnav">

    <li class="toctree-l2"><a href="#troubleshooting">Troubleshooting</a></li>

        <ul>

            <li><a class="toctree-l3" href="#syntax-error">Syntax error</a></li>

            <li><a class="toctree-l3" href="#no-internet-connection">No Internet Connection</a></li>

            <li><a class="toctree-l3" href="#firewall-restrictions">Firewall Restrictions</a></li>

            <li><a class="toctree-l3" href="#no-information-to-sync">No information to Sync</a></li>

            <li><a class="toctree-l3" href="#waiting-time">Waiting time</a></li>

            <li><a class="toctree-l3" href="#upload-limit">Upload Limit</a></li>

            <li><a class="toctree-l3" href="#special-characters">Special Characters</a></li>

            <li><a class="toctree-l3" href="#schema-limitations">Schema Limitations</a></li>

            <li><a class="toctree-l3" href="#mysql-schemas-are-created-but-no-data-is-loaded">MySQL schemas are created but no data is loaded</a></li>

            <li><a class="toctree-l3" href="#debugging-s3stream">Debugging S3Stream</a></li>

            <li><a class="toctree-l3" href="#load-from-s3-privileges">LOAD FROM S3 privileges</a></li>

            <li><a class="toctree-l3" href="#firebird-column-name-starts-with-underscore">Firebird column name starts with underscore</a></li>

            <li><a class="toctree-l3" href="#need-more-help">Need more help?</a></li>

        </ul>


    </ul>
	    </li>

            <li class="toctree-l1">

    <a class="" href="../about/">About</a>
	    </li>

        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">


      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">Bipost Sync</a>
      </nav>


      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>



    <li>Troubleshooting</li>
    <li class="wy-breadcrumbs-aside">

    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">

                <h1 id="troubleshooting">Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permanent link">&para;</a></h1>
<p>When make a successful synchronization the following dialog appears.</p>
<p><img alt="Bipost successful sync" src="../img/sync_completed.png" /></p>
<p>If you face any errors, try looking here.</p>
<hr />
<h2 id="syntax-error">Syntax error<a class="headerlink" href="#syntax-error" title="Permanent link">&para;</a></h2>
<p>Misspelled fields or tables on customData.json may appear as:</p>
<p><img alt="customData syntax error" src="../img/customDataSyntaxError.png" /></p>
<hr />
<h2 id="no-internet-connection">No Internet Connection<a class="headerlink" href="#no-internet-connection" title="Permanent link">&para;</a></h2>
<p>When no internet connection available, the following message appears:</p>
<p><img alt="S3 NameResolutionFailure" src="../img/NameResolutionFailure.png" /></p>
<hr />
<h2 id="firewall-restrictions">Firewall Restrictions<a class="headerlink" href="#firewall-restrictions" title="Permanent link">&para;</a></h2>
<p>If your internet connection has a firewall, it may show different errors like:</p>
<ul>
<li>The remote name could not be resolved.</li>
<li>A WebException with status SendFailure was thrown.</li>
<li>A WebException with status NameResolutionFailure was thrown.</li>
<li>Error making request with Error Code ExpectationFailed and Http Status Code ExpectationFailed.</li>
</ul>
<p><img alt="Firewall Restrictions to S3" src="../img/Error_Code_ExpectationFailed.png" /></p>
<h3 id="grant-firewall-to-reach-amazon-s3">Grant Firewall to reach Amazon S3<a class="headerlink" href="#grant-firewall-to-reach-amazon-s3" title="Permanent link">&para;</a></h3>
<p>Create a policy to Allow to:</p>
<ul>
<li><code>54.230.0.0/15</code></li>
<li><code>52.192.0.0/11</code></li>
</ul>
<p><img alt="Firewall policy to reach AWS S3" src="../img/FirewallAllowTo.png" /></p>
<p>AWS can have multiple IP addresses for S3 service, so in case the above IP's don't work check the <a href="https://aws.amazon.com/blogs/aws/aws-ip-ranges-json/" target="_blank">AWS Public IP Address Ranges documentation</a> <a href=""></a> and look for</p>
<pre><code>  "region": "GLOBAL",
  "service": "AMAZON"
</code></pre>
<p>and</p>
<pre><code>  "region": "us-east-1",
  "service": "AMAZON"
</code></pre>
<p><a href="https://ip-ranges.amazonaws.com/ip-ranges.json" target="_blank">https://ip-ranges.amazonaws.com/ip-ranges.json</a></p>
<hr />
<h2 id="no-information-to-sync">No information to Sync<a class="headerlink" href="#no-information-to-sync" title="Permanent link">&para;</a></h2>
<p>If <code>No information to Sync</code> message appears, verify that customData.json is set to send at least one table.</p>
<hr />
<h2 id="waiting-time">Waiting time<a class="headerlink" href="#waiting-time" title="Permanent link">&para;</a></h2>
<p>Bipost Sync may take from a few seconds to several minutes to extract from on-prem DB and upload to AWS. While this is happening no messages/icons will show that biPost.exe is working and maybe you'll see <code>(Not responding)</code> on the top of the window, this is normal.</p>
<p>If you launch Windows Task Manager probably you'll see that <code>biPost.exe *32</code> is running and consuming a considerable amount of CPU.</p>
<p>Once the information is uploaded to AWS, it is usually available on Aurora-MySQL very fast. If a big data set was uploaded it may take up to 5 minutes to be available on Aurora.</p>
<p>Verify which tables where loaded by querying <code>aurora_s3_load_history</code> table like this:</p>
<pre><code>SELECT * FROM mysql.aurora_s3_load_history WHERE file_name REGEXP 'mytablename' ORDER BY load_timestamp desc;
</code></pre>
<p>Optionally convert <code>load_timestamp</code> to your local time, e.g.: <code>CONVERT_TZ(load_timestamp,'UTC','America/Mexico_City')</code></p>
<hr />
<h2 id="upload-limit">Upload Limit<a class="headerlink" href="#upload-limit" title="Permanent link">&para;</a></h2>
<p>Depending on the number of rows and columns on each table, it is possible that a large amount of data sent on a single sync may not load to Aurora-MySQL.</p>
<p>We have tested up to 1.5 million rows on a single sync or 280 MB uncompressed files.</p>
<p>We recommend using <a href="../customdatajson">Recursive Sync</a> for big tables that have a date field available.</p>
<hr />
<h2 id="special-characters">Special Characters<a class="headerlink" href="#special-characters" title="Permanent link">&para;</a></h2>
<p>Line breaks are not supported and thus removed.</p>
<hr />
<h2 id="schema-limitations">Schema Limitations<a class="headerlink" href="#schema-limitations" title="Permanent link">&para;</a></h2>
<p>Only tables with a <code>PRIMARY KEY</code> are available to synchronize. If a table does not have a PRIMARY KEY an error message will appear.</p>
<p>As a workaround, you can manually create the tables with a PRIMARY KEY on Aurora-MySQL and then synchronize. On-prem schema changes (e.g. adding columns) will not synchronize unless on-prem tables use primary keys.</p>
<hr />
<h2 id="mysql-schemas-are-created-but-no-data-is-loaded">MySQL schemas are created but no data is loaded<a class="headerlink" href="#mysql-schemas-are-created-but-no-data-is-loaded" title="Permanent link">&para;</a></h2>
<p>Two things might be causing this problem:</p>
<h4 id="1-rds-instance-cannot-reach-s3-bucket">1. RDS instance cannot reach S3 bucket.<a class="headerlink" href="#1-rds-instance-cannot-reach-s3-bucket" title="Permanent link">&para;</a></h4>
<p>When we look at our CloudWatch logs, we see <code>Unable to initialize S3Stream</code>, so do the following:</p>
<ul>
<li>Go to <a href="../easyawssetup/#step-5-add-role-to-cluster">RDS Clusters</a> and check if <strong>IAM Role</strong> is listed and active for your cluster.</li>
</ul>
<p>If you <strong>manually</strong> created AWS Services then:</p>
<ul>
<li>
<p>Check if your <a href="../setupaws/#iam-policy-to-grant-access-to-s3">IAM Policy to Grant Access to S3</a> is set correctly using the S3 bucket ARN we provided. Also double check the policy document (JSON).</p>
</li>
<li>
<p>Check that <a href="../setupaws/#iam-role-to-load-data-from-s3">IAM Role</a> has attached the former IAM Policy. Copy ARN Role to a notepad for next steps.</p>
</li>
<li>
<p>Go to <a href="../setupaws/#create-cluster-parameter-group">RDS Parameter Groups</a>, select the cluster group and click <strong>Compare Parameters</strong>, it should show the IAM ARN Role (the one you just copied on a notepad) on the parameters shown <a href="../setupaws/#create-cluster-parameter-group">here.</a></p>
</li>
<li>
<p>Double check IAM roles attached to your instance querying <code>show global variables like '%role%'</code></p>
</li>
</ul>
<p><img alt="Aurora MySQL SHOW GLOBAL VARIABLES" src="../img/show-global-variables.png" /></p>
<p>After this, if you still experience this error, check out <a href="../troubleshooting/#debugging-s3stream">Manually debugging S3Stream.</a></p>
<h4 id="2-name-of-your-mysql-database-must-be-all-lower-case">2. Name of your MySQL database must be all lower case.<a class="headerlink" href="#2-name-of-your-mysql-database-must-be-all-lower-case" title="Permanent link">&para;</a></h4>
<p>When we look at our CloudWatch logs, we see:</p>
<p><code>SequelizeConnectionError: ER_BAD_DB_ERROR: Unknown database</code></p>
<p>Double check that your DB name is all lower case.</p>
<hr />
<h2 id="debugging-s3stream">Debugging S3Stream<a class="headerlink" href="#debugging-s3stream" title="Permanent link">&para;</a></h2>
<p>In this section we will manually upload data to Aurora-MySQL. The goal here is to see whether an error is shown while directly importing data from S3 to Aurora-MySQL.</p>
<h4 id="create-dummy-table">Create Dummy Table<a class="headerlink" href="#create-dummy-table" title="Permanent link">&para;</a></h4>
<p>Using MySQL Workbench open a connection to your MySQL instance using <code>root</code> account.</p>
<p>Let's create a dummy table:</p>
<pre><code>CREATE TABLE `dummytable` (
  `CIUDAD_ID` int(4) NOT NULL,
  `NOMBRE` varchar(50) COLLATE latin1_spanish_ci NOT NULL,
  `CLAVE_FISCAL` varchar(3) COLLATE latin1_spanish_ci DEFAULT NULL,
  `ES_PREDET` char(1) COLLATE latin1_spanish_ci DEFAULT NULL,
  `ESTADO_ID` int(4) NOT NULL,
  `USUARIO_CREADOR` varchar(31) COLLATE latin1_spanish_ci DEFAULT NULL,
  `FECHA_HORA_CREACION` datetime DEFAULT NULL,
  `USUARIO_AUT_CREACION` varchar(31) COLLATE latin1_spanish_ci DEFAULT NULL,
  `USUARIO_ULT_MODIF` varchar(31) COLLATE latin1_spanish_ci DEFAULT NULL,
  `FECHA_HORA_ULT_MODIF` datetime DEFAULT NULL,
  `USUARIO_AUT_MODIF` varchar(31) COLLATE latin1_spanish_ci DEFAULT NULL,
  PRIMARY KEY (`CIUDAD_ID`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1 COLLATE=latin1_spanish_ci;
</code></pre>
<h4 id="load-data-from-s3">LOAD DATA FROM S3<a class="headerlink" href="#load-data-from-s3" title="Permanent link">&para;</a></h4>
<p>Replace curly brackets with your parameters:</p>
<ul>
<li><strong>my-bucket-name</strong>: Name of your dedicated bucket.</li>
<li><strong>my-database-name</strong>: Name of your database on MySQL.</li>
</ul>
<p>Now run on Workbench:</p>
<pre><code>LOAD DATA FROM S3 's3-us-east-1://{my-bucket-name}/DUMMYTABLE.csv'
REPLACE INTO TABLE `{my-database-name}`.`dummytable`
CHARACTER SET 'utf8'
FIELDS TERMINATED BY '|'
ENCLOSED BY '\"'
LINES TERMINATED BY '\r\n'
IGNORE 1 LINES
(CIUDAD_ID,NOMBRE,CLAVE_FISCAL,ES_PREDET,ESTADO_ID,USUARIO_CREADOR,FECHA_HORA_CREACION,USUARIO_AUT_CREACION,USUARIO_ULT_MODIF,FECHA_HORA_ULT_MODIF,USUARIO_AUT_MODIF);
</code></pre>
<p><strong>Example</strong></p>
<pre><code>LOAD DATA FROM S3 's3-us-east-1://bipostdata-123456789012/DUMMYTABLE.csv'
REPLACE INTO TABLE `mytestdb`.`dummytable`
CHARACTER SET 'utf8'
FIELDS TERMINATED BY '|'
ENCLOSED BY '\"'
LINES TERMINATED BY '\r\n'
IGNORE 1 LINES
(CIUDAD_ID,NOMBRE,CLAVE_FISCAL,ES_PREDET,ESTADO_ID,USUARIO_CREADOR,FECHA_HORA_CREACION,USUARIO_AUT_CREACION,USUARIO_ULT_MODIF,FECHA_HORA_ULT_MODIF,USUARIO_AUT_MODIF);
</code></pre>
<p><img alt="Unable to initialize S3Stream" src="../img/Unable-to-initialize-S3Stream.png" /></p>
<hr />
<h2 id="load-from-s3-privileges">LOAD FROM S3 privileges<a class="headerlink" href="#load-from-s3-privileges" title="Permanent link">&para;</a></h2>
<p>The Aurora user that executes <strong>LOAD DATA FROM S3</strong> requires the following privilege:</p>
<p><code>GRANT LOAD FROM S3 ON *.* TO 'your-user-name';</code></p>
<p>By default this privilege is set to your <strong>Master Username</strong> when you <a href="../setupaws/#aurora-instance">created your Aurora instance.</a></p>
<p>If you are using a different user and the privilege is not set, the following error appears:</p>
<p><code>Access denied; you need (at least one of) the LOAD FROM S3 privilege(s) for this operation</code></p>
<p>The only way to see this error is executing <strong>LOAD FROM S3</strong> <a href="../troubleshooting/#debugging-s3stream">manually.</a></p>
<p>If your MySQL user already has this privilege and you see the following error, try <a href="../troubleshooting/#1-rds-instance-cannot-reach-s3-bucket">these steps.</a></p>
<p><code>Access denied for user 'your-user-name'@'xx.xx.xxx.xxx' (using password: YES)</code></p>
<hr />
<h2 id="firebird-column-name-starts-with-underscore">Firebird column name starts with underscore<a class="headerlink" href="#firebird-column-name-starts-with-underscore" title="Permanent link">&para;</a></h2>
<p>Firebird SQL does not naturally support creating colums names starting with underscore, so avoid that on Aurora if your on-prem DB is Firebird.</p>
<p><code>Token unknown - line 1</code></p>
<p><img alt="Firebird column name starts with underscore" src="../img/underscore_error_Firebird.png" /></p>
<hr />
<h2 id="need-more-help">Need more help?<a class="headerlink" href="#need-more-help" title="Permanent link">&para;</a></h2>
<p>Please send us an email to: <a href="mailto:info@factorbi.com">info@factorbi.com</a></p>

            </div>
          </div>
          <footer>

    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">

        <a href="../about/" class="btn btn-neutral float-right" title="About">Next <span class="icon icon-circle-arrow-right"></span></a>


        <a href="../setupaws/" class="btn btn-neutral" title="Advanced AWS Setup"><span class="icon icon-circle-arrow-left"></span> Previous</a>

    </div>


  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->

      <p>© 2016 - 2018, <a href="https://www.factorbi.com">Factor BI, S.A. de C.V.</a> All rights reserved.</p>

  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">


        <span><a href="../setupaws/" style="color: #fcfcfc;">&laquo; Previous</a></span>


        <span style="margin-left: 15px"><a href="../about/" style="color: #fcfcfc">Next &raquo;</a></span>

    </span>
</div>
    <script src="../js/theme.js"></script>

</body>
</html>
